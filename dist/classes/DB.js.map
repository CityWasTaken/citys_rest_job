{"version":3,"file":"DB.js","sourceRoot":"","sources":["../../src/classes/DB.ts"],"names":[],"mappings":"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","sourcesContent":["import client from '../db/connection.js';\n\ntype Employee = {\n  first_name: string;\n  last_name: string;\n  role_id: string;\n  manager_id: string;\n}\n\ntype Role = {\n  title: string;\n  salary: number;\n  department_id: number;\n}\n\nclass DB {\n  // EMPLOYEES\n  static async getEmployees() {\n    const {rows} = await client.query(`\n      SELECT\n        d.name AS department,\n        e.id AS employee_id, \n        CONCAT(e.first_name, ' ', e.last_name) AS full_name,\n        title,\n        r.salary,\n        COALESCE(NULLIF(CONCAT(COALESCE(m.first_name, ''), ' ', COALESCE(m.last_name, '')), ' '), 'N/A') AS manager\n      FROM employees e\n      JOIN roles r ON e.role_id = r.id\n      JOIN departments d ON r.department_id = d.id\n      LEFT JOIN employees m ON e.manager_id = m.id\n      ORDER BY d.name\n    `);\n\n    return rows;\n  }\n\n  static async getEmployeesByDepartment(dep_id: number) {\n    const { rows } = await client.query(`\n      SELECT\n        e.id,\n        CONCAT(first_name, ' ', last_name) AS employee_name,\n        name\n      FROM employees e\n      JOIN roles r\n        ON r.id = e.role_id\n      JOIN departments d\n       ON d.id = r.department_id\n      WHERE d.id = $1\n    `, [dep_id]);\n\n    return rows;\n  }\n\n  static async addEmployee({\n    first_name,\n    last_name,\n    role_id,\n    manager_id\n  }: Employee) {\n    await client.query(`\n      INSERT INTO employees (first_name, last_name, role_id, manager_id) VALUES ($1, $2, $3, $4)\n    `, [first_name, last_name, role_id, manager_id]);\n\n    return true;\n  }\n\n  // DEPARTMENTS\n  static async getDepartments() {\n    const {rows} = await client.query('SELECT * FROM departments');\n\n    return rows;\n  }\n\n  static async addDepartment(name: string) {\n    const {rows} = await client.query('SELECT * FROM departments');\n    if (rows.find(d => d.name.toLowerCase() === name.toLowerCase())) {\n      return false;\n    }\n\n    await client.query('INSERT INTO departments (name) VALUES ($1)', [name]);\n\n    return true;\n  }\n\n  // ROLES\n  static async getRoles() {\n    const { rows } = await client.query(`\n      SELECT\n        r.id,\n        title,\n        salary,\n        d.name AS department\n      FROM roles r\n      JOIN departments d\n        ON r.department_id = d.id\n      ORDER BY d.id\n    `);\n\n    return rows;\n  }\n\n  static async getRolesByDepartment(dep_id: number) {\n    const {rows} = await client.query(`\n      SELECT\n        id,\n        title\n      FROM roles\n      WHERE department_id = $1\n    `, [dep_id]);\n\n    return rows;\n  }\n\n  static async updateEmployeeRole(employee_id: number, role_id: number) {\n    await client.query(`UPDATE employees SET role_id = $2 WHERE id = $1`, [employee_id, role_id]);\n\n    return true;\n  }\n\n  static async addRole({\n    title,\n    salary,\n    department_id\n  }: Role) {\n    const roles = await this.getRolesByDepartment(department_id);\n\n    if (roles.find(r => r.title.toLowerCase() === title.toLowerCase())) {\n      return false;\n    }\n\n    await client.query(`\n      INSERT INTO roles (\n        title,\n        salary,\n        department_id\n      ) VALUES ($1, $2, $3)\n    `, [title, salary, department_id]);\n\n    return true;\n  }\n}\n\nexport default DB;\n\n\n\n// static async getRolesByEmployee(employee_id: number) {\n//   const {rows: roles} = await client.query(`\n//     SELECT\n//       r.id,\n//       r.title,\n//       d.name AS department\n//     FROM roles r\n//     JOIN departments d\n//       ON r.department_id = d.id\n//     WHERE d.id = (\n//       SELECT\n//         department_id\n//       FROM roles r\n//       JOIN employees e\n//       ON e.role_id = r.id\n//       WHERE e.id = $1\n//     )\n//   `, [employee_id]);\n\n//   return roles;\n// }"]}